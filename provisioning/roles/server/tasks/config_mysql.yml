---

- name: Set Python interpreter to Python 3
  set_fact:
    ansible_python_interpreter: /usr/bin/python3

- name: Install python3
  apt:
    pkg:
     - python3
     - python3-pip
     - python3-mysqldb
    update_cache: yes

- name: Set Python interpreter to Python 3
  set_fact:
    ansible_python_interpreter: /usr/bin/python3

- name: Secure MySQL Installation
  mysql_user:
    login_user: root
    login_password: ""
    user: root
    host: localhost
    password: "{{ mysql_root_password }}"
    priv: "*.*:ALL,GRANT"
    state: present

- name: Create MySQL User
  mysql_user:
    login_user: root
    login_password: "{{ mysql_root_password }}"
    user: "{{ mysql_user }}"
    host: localhost
    password: "{{ mysql_user_password }}"
    priv: "*.*:ALL"
    state: present

- name: Create Database
  mysql_db:
    name: movie_blog
    state: present
    login_user: root
    login_password: "{{ mysql_root_password }}"

- name: Create Movies Table
  mysql_query:
    login_user: root
    login_password: "{{ mysql_root_password }}"
    db: movie_blog
    query: |
      CREATE TABLE movies (
        movie_id INT AUTO_INCREMENT PRIMARY KEY,
        title VARCHAR(255) NOT NULL,
        description TEXT,
        release_date DATE,
        poster_url VARCHAR(255)
      )
  ignore_errors: true

- name: Create movies.sql
  copy:
    dest: /opt/movies.sql
    src: movies.sql
  
- name: Insert Sample Data
  mysql_db:
    name: movie_blog
    state: import
    login_user: root
    login_password: "{{ mysql_root_password }}"
    target: /opt/movies.sql
...
